"use strict";(self.webpackChunkreact_luo=self.webpackChunkreact_luo||[]).push([[273],{39711:function(e,t,n){n.r(t),n.d(t,{default:function(){return j}});n(83646);var a,r=n(85149),o=(n(97392),n(74572)),i=(n(22642),n(94099)),s=n(45443),l=(n(95760),n(79013)),c=(n(93542),n(41741)),u=n(82173),d=(n(30153),n(11248)),m=(n(17510),n(7939)),p=(n(17652),n(27220)),f=(n(84113),n(66847)),h=n(81915),y=n(13475),k=n(15535),v=n(76815),E=n(81072),Z=n(13246),b=n(23080),g=(n(17819),n(24996)),S=(n(78464),n(88390)),w=(n(87119),n(3331)),D=n(99700),x=n.n(D),C=n(59496),T=n(18071),I=(n(30796),n(32699)),N=n.n(I),M=n(45589),R=n(14154),U=n(27478),B=n(72423),q=["icon-Dollar","icon-compass","icon-EURO","icon-time-circle","icon-earth","icon-YUAN","icon-message","icon-dashboard","icon-piechart","icon-setting","icon-eye","icon-save","icon-appstore","icon-control","icon-detail","icon-project","icon-wallet","icon-user","icon-team","icon-areachart","icon-linechart","icon-barchart","icon-pointmap","icon-database","icon-reconciliation","icon-securityscan","icon-propertysafety","icon-safetycertificate","icon-alert","icon-bulb","icon-trophy","icon-USB","icon-home","icon-like","icon-unlock","icon-lock","icon-customerservice","icon-flag","icon-moneycollect","icon-medicinebox","icon-shop","icon-rocket","icon-shopping","icon-folder","icon-folder-open","icon-sliders","icon-cloud","icon-crown","icon-desktop","icon-gift"],L=n(69840);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,Z.Z)(e);if(t){var r=(0,Z.Z)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,E.Z)(this,n)}}var P=w.Z.TreeNode,J=S.default.Option,F=g.Z.TextArea,j=(0,T.$j)((function(e){return{roles:e.sys.roles,powersCode:e.app.powersCode}}),(function(e){return{addMenu:e.sys.addMenu,getMenus:e.sys.getMenus,upMenu:e.sys.upMenu,delMenu:e.sys.delMenu}}))(a=function(e){(0,v.Z)(a,e);var t,n=O(a);function a(e){var t;return(0,h.Z)(this,a),t=n.call(this,e),(0,b.Z)((0,k.Z)(t),"onTreeSelect",(function(e,n){var a={};n.selected&&(a={title:n.node.title,id:n.node.id}),t.setState({treeSelect:a,tableData:t.state.data.filter((function(e){return e.parent===(Number(a.id)||null)}))})})),(0,b.Z)((0,k.Z)(t),"getNameByParentId",(function(e){var n=t.state.data.find((function(t){return t.id===e}));return n?n.title:void 0})),(0,b.Z)((0,k.Z)(t),"onModalShow",(function(e,n){t.setState({modalShow:!0,nowData:e,operateType:n,formParent:"add"===n?{label:void 0,value:void 0}:{label:t.getNameByParentId(e.parent),value:e.parent}}),setTimeout((function(){"add"===n?t.form.current.resetFields():t.form.current.setFieldsValue({formConditions:e.conditions,formDesc:e.desc,formIcon:e.icon,formSorts:e.sorts,formTitle:e.title,formUrl:e.url})}))})),(0,b.Z)((0,k.Z)(t),"onClose",(function(){t.setState({modalShow:!1})})),(0,b.Z)((0,k.Z)(t),"onDel",(function(e){var n={id:e.id};t.props.delMenu(n).then((function(e){200===e.status?(t.getData(),t.props.updateUserInfo(),f.default.success("删除成功")):f.default.error(e.message)}))})),(0,b.Z)((0,k.Z)(t),"makeColumns",(function(){return[{title:"序号",dataIndex:"serial",key:"serial"},{title:"图标",dataIndex:"icon",key:"icon",render:function(e){return e?C.createElement(L.Z,{type:e}):""}},{title:"菜单名称",dataIndex:"title",key:"title"},{title:"路径",dataIndex:"url",key:"url",render:function(e,t){return e?"/".concat(e.replace(/^\//,"")):""}},{title:"描述",dataIndex:"desc",key:"desc"},{title:"父级",dataIndex:"parent",key:"parent",render:function(e){return t.getNameByParentId(e)}},{title:"状态",dataIndex:"conditions",key:"conditions",render:function(e,t){return 1===e?C.createElement("span",{style:{color:"green"}},"启用"):C.createElement("span",{style:{color:"red"}},"禁用")}},{title:"操作",key:"control",width:120,render:function(e,n){var a=t.props.powersCode,r=[];a.includes("menu:query")&&r.push(C.createElement("span",{key:"0",className:"control-btn green",onClick:function(){return t.onModalShow(n,"see")}},C.createElement(p.default,{placement:"top",title:"查看"},C.createElement(M.Z,null)))),a.includes("menu:up")&&r.push(C.createElement("span",{key:"1",className:"control-btn blue",onClick:function(){return t.onModalShow(n,"up")}},C.createElement(p.default,{placement:"top",title:"修改"},C.createElement(R.Z,null)))),a.includes("menu:del")&&r.push(C.createElement(m.Z,{key:"2",title:"确定删除吗?",okText:"确定",cancelText:"取消",onConfirm:function(){return t.onDel(n)}},C.createElement("span",{className:"control-btn red"},C.createElement(p.default,{placement:"top",title:"删除"},C.createElement(U.Z,null)))));var o=[];return r.forEach((function(e,t){t&&o.push(C.createElement(d.Z,{key:"line".concat(t),type:"vertical"})),o.push(e)})),o}}]})),t.form=C.createRef(),t.state={data:[],sourceData:[],loading:!1,tableData:[],treeSelect:{},nowData:null,operateType:"add",modalShow:!1,modalLoading:!1,rolesCheckboxChose:[]},t}return(0,y.Z)(a,[{key:"componentDidMount",value:function(){this.getData()}},{key:"getData",value:function(){var e=this;this.props.powersCode.includes("menu:query")&&(this.setState({loading:!0}),this.props.getMenus().then((function(t){200===t.status&&(e.setState({data:t.data,tableData:t.data.filter((function(t){return t.parent===(Number(e.state.treeSelect.id)||null)}))}),e.makeSourceData(t.data)),e.setState({loading:!1})})).catch((function(){e.setState({loading:!1})})))}},{key:"makeSourceData",value:function(e){var t=N().cloneDeep(e);t.forEach((function(e){e.key=String(e.id)})),t.sort((function(e,t){return e.sorts-t.sorts}));var n=this.dataToJson(null,t)||[];this.setState({sourceData:n})}},{key:"dataToJson",value:function(e,t){var n,a=this;return(n=e?t.filter((function(t){return t.parent===e.id})):t.filter((function(e){return!e.parent}))).forEach((function(e){return e.children=a.dataToJson(e,t)})),n.length?n:null}},{key:"makeTreeDom",value:function(e){var t=this;return e.map((function(e){return e.children?C.createElement(P,{title:e.title,key:"".concat(e.id)},t.makeTreeDom(e.children)):C.createElement(P,{title:e.title,key:"".concat(e.id)})}))}},{key:"onOk",value:(t=(0,u.Z)(x().mark((function e(){var t,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("see"!==this.state.operateType){e.next=3;break}return this.onClose(),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.form.current.validateFields();case 6:if(t=e.sent,n={title:t.formTitle,url:t.formUrl,icon:t.formIcon,parent:Number(this.state.treeSelect.id)||null,sorts:t.formSorts,desc:t.formDesc,conditions:t.formConditions},this.setState({modalLoading:!0}),"add"!==this.state.operateType){e.next=20;break}return e.prev=10,e.next=13,this.props.addMenu(n);case 13:200===e.sent.status?(f.default.success("添加成功"),this.getData(),this.onClose(),this.props.updateUserInfo()):f.default.error("添加失败");case 15:return e.prev=15,this.setState({modalLoading:!1}),e.finish(15);case 18:e.next=29;break;case 20:return e.prev=20,n.id=this.state.nowData.id,e.next=24,this.props.upMenu(n);case 24:200===e.sent.status?(f.default.success("修改成功"),this.getData(),this.onClose(),this.props.updateUserInfo()):f.default.error("修改失败");case 26:return e.prev=26,this.setState({modalLoading:!1}),e.finish(26);case 29:e.next=33;break;case 31:e.prev=31,e.t0=e.catch(3);case 33:case"end":return e.stop()}}),e,this,[[3,31],[10,,15,18],[20,,26,29]])}))),function(){return t.apply(this,arguments)})},{key:"makeData",value:function(e){return e?e.map((function(e,t){return{key:t,id:e.id,icon:e.icon,parent:e.parent,title:e.title,url:e.url,desc:e.desc,sorts:e.sorts,conditions:e.conditions,serial:t+1}})):[]}},{key:"render",value:function(){var e=this,t=this.props.powersCode,n={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}};return C.createElement("div",{className:"page-menu-admin"},C.createElement("div",{className:"l"},C.createElement("div",{className:"title"},"目录结构"),C.createElement("div",null,C.createElement(w.Z,{defaultExpandedKeys:["0"],onSelect:this.onTreeSelect,selectedKeys:[String(this.state.treeSelect.id)],treeData:this.state.sourceData}))),C.createElement("div",{className:"r"},C.createElement("div",{className:"searchBox"},C.createElement("ul",null,C.createElement("li",null,C.createElement(c.default,{type:"primary",icon:C.createElement(B.Z,null),onClick:function(){return e.onModalShow(null,"add")},disabled:!t.includes("menu:add")},"添加".concat(this.state.treeSelect.title||"根级","子菜单"))))),C.createElement(l.Z,{className:"diy-table",columns:this.makeColumns(),loading:this.state.loading,dataSource:this.makeData(this.state.tableData),pagination:{showQuickJumper:!0,showTotal:function(e,t){return"共 ".concat(e," 条数据")}}})),C.createElement(r.Z,{title:"".concat({add:"新增",up:"修改",see:"查看"}[this.state.operateType]),visible:this.state.modalShow,onOk:function(){return e.onOk()},onCancel:this.onClose,confirmLoading:this.state.modalLoading},C.createElement(i.Z,{ref:this.form,initialValues:{formConditions:1}},C.createElement(i.Z.Item,(0,s.Z)({label:"菜单名",name:"formTitle"},n,{rules:[{required:!0,whitespace:!0,message:"必填"},{max:12,message:"最多输入12位字符"}]}),C.createElement(g.Z,{placeholder:"请输入菜单名",disabled:"see"===this.state.operateType})),C.createElement(i.Z.Item,(0,s.Z)({label:"菜单链接",name:"formUrl"},n,{rules:[{required:!0,whitespace:!0,message:"必填"}]}),C.createElement(g.Z,{placeholder:"请输入菜单链接",disabled:"see"===this.state.operateType})),C.createElement(i.Z.Item,(0,s.Z)({label:"图标",name:"formIcon"},n),C.createElement(S.default,{dropdownClassName:"iconSelect",disabled:"see"===this.state.operateType},q.map((function(e,t){return C.createElement(J,{key:t,value:e},C.createElement(L.Z,{type:e}))})))),C.createElement(i.Z.Item,(0,s.Z)({label:"描述",name:"formDesc"},n,{rules:[{max:100,message:"最多输入100位字符"}]}),C.createElement(F,{rows:4,disabled:"see"===this.state.operateType,placeholoder:"请输入描述",autosize:{minRows:2,maxRows:6}})),C.createElement(i.Z.Item,(0,s.Z)({label:"排序",name:"formSorts"},n,{rules:[{required:!0,message:"请输入排序号"}]}),C.createElement(o.Z,{min:0,max:99999,style:{width:"100%"},disabled:"see"===this.state.operateType})),C.createElement(i.Z.Item,(0,s.Z)({label:"状态",name:"formConditions"},n,{rules:[{required:!0,message:"请选择状态"}]}),C.createElement(S.default,{disabled:"see"===this.state.operateType},C.createElement(J,{key:1,value:1},"启用"),C.createElement(J,{key:-1,value:-1},"禁用"))),"add"===this.state.operateType?C.createElement(i.Z.Item,(0,s.Z)({label:"赋予"},n),C.createElement("span",{style:{color:"green"}},"新增菜单后请前往角色管理将菜单授权给相关角色")):null)))}}]),a}(C.Component))||a}}]);