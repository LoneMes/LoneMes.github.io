"use strict";(self.webpackChunkreact_luo=self.webpackChunkreact_luo||[]).push([[445],{36531:function(e,t,a){a.d(t,{Z:function(){return i}});var n=a(44367),r=a(59496),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"},o=a(1719),l=function(e,t){return r.createElement(o.Z,(0,n.Z)((0,n.Z)({},e),{},{ref:t,icon:s}))};l.displayName="EditOutlined";var i=r.forwardRef(l)},74532:function(e,t,a){a.d(t,{Z:function(){return i}});var n=a(44367),r=a(59496),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},o=a(1719),l=function(e,t){return r.createElement(o.Z,(0,n.Z)((0,n.Z)({},e),{},{ref:t,icon:s}))};l.displayName="SearchOutlined";var i=r.forwardRef(l)},17190:function(e,t,a){a.r(t),a.d(t,{default:function(){return J}});a(83646);var n=a(85149),r=(a(22642),a(94099)),s=a(45443),o=(a(95760),a(79013)),l=(a(93542),a(41741)),i=(a(30153),a(11248)),c=(a(17510),a(7939)),u=(a(17652),a(27220)),d=a(82173),m=(a(84113),a(66847)),h=a(81915),p=a(13475),f=a(76815),y=a(81072),v=a(13246),g=(a(78464),a(88390)),k=(a(17819),a(24996)),E=a(99700),C=a.n(E),Z=a(59496),w=a(18071),S=a(45589),D=a(14154),T=a(36531),b=a(27478),N=a(72423),R=a(74532),x=a(30796),L=a(15535),U=a(23080),z=(a(87119),a(3331)),O=a(32699),P=a.n(O);function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,v.Z)(e);if(t){var r=(0,v.Z)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,y.Z)(this,a)}}var K,M=z.Z.TreeNode,G=function(e){(0,f.Z)(a,e);var t=I(a);function a(e){var n;return(0,h.Z)(this,a),n=t.call(this,e),(0,U.Z)((0,L.Z)(n),"onOk",(function(){var e=n.props.data.filter((function(e){return n.state.nowKeys.includes("".concat(e.id))}));n.props.onOk&&n.props.onOk(n.state.nowKeys,e)})),(0,U.Z)((0,L.Z)(n),"onClose",(function(){n.props.onClose()})),(0,U.Z)((0,L.Z)(n),"onCheck",(function(e){n.setState({nowKeys:e})})),n.state={sourceData:[],nowKeys:[]},n}return(0,p.Z)(a,[{key:"componentDidMount",value:function(){this.makeSourceData(this.props.data)}},{key:"componentDidUpdate",value:function(e){this.props.data!==e.data&&this.makeSourceData(this.props.data),this.props.defaultKeys!==e.defaultKeys&&this.setState({nowKeys:this.props.defaultKeys.map((function(e){return"".concat(e)}))})}},{key:"makeSourceData",value:function(e){var t=P().cloneDeep(e);t.forEach((function(e){e.key=String(e.id)}));var a=this.dataToJson(null,t)||[];this.setState({sourceData:a})}},{key:"dataToJson",value:function(e,t){var a,n=this;return(a=e?t.filter((function(t){return t.parent===e.id})):t.filter((function(e){return!e.parent}))).forEach((function(e){return e.children=n.dataToJson(e,t)})),a.length?a:null}},{key:"makeTreeDom",value:function(e){var t=this;return e.map((function(e,a){return e.children?Z.createElement(M,{title:e.title,key:e.id,data:e,selectable:!1},t.makeTreeDom(e.children)):Z.createElement(M,{title:e.title,key:e.id,data:e,selectable:!1})}))}},{key:"render",value:function(){var e=this;return Z.createElement(n.Z,{title:this.props.title||"请选择",visible:this.props.visible,wrapClassName:"menuTreeModal",confirmLoading:this.props.loading,onOk:this.onOk,onCancel:this.onClose},Z.createElement(z.Z,{checkable:!0,selectable:!1,checkedKeys:this.state.nowKeys,onCheck:function(t){return e.onCheck(t)},treeData:this.state.sourceData}))}}]),a}(Z.PureComponent);function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,v.Z)(e);if(t){var r=(0,v.Z)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,y.Z)(this,a)}}var q=k.Z.TextArea,A=g.default.Option,J=(0,w.$j)((function(e){return{powerTreeData:e.sys.powerTreeData,userinfo:e.app.userinfo,powersCode:e.app.powersCode}}),(function(e){return{getAllRoles:e.sys.getAllRoles,addUser:e.sys.addUser,upUser:e.sys.upUser,delUser:e.sys.delUser,getUserList:e.sys.getUserList}}))(K=function(e){(0,f.Z)(y,e);var t,a=B(y);function y(e){var t;return(0,h.Z)(this,y),(t=a.call(this,e)).form=Z.createRef(),t.state={data:[],roleData:[],operateType:"add",loading:!1,searchUsername:void 0,searchConditions:void 0,modalShow:!1,modalLoading:!1,nowData:null,roleTreeShow:!1,roleTreeDefault:[],pageNum:1,pageSize:10,total:0,treeLoading:!1,treeOnOkLoading:!1},t}return(0,p.Z)(y,[{key:"componentDidMount",value:function(){this.onGetData(this.state.pageNum,this.state.pageSize),this.onGetRoleTreeData()}},{key:"onGetRoleTreeData",value:function(){var e=this;this.props.getAllRoles().then((function(t){200===t.status&&e.setState({roleData:t.data})}))}},{key:"onGetData",value:function(e,t){var a=this;if(this.props.powersCode.includes("user:query")){var n={pageNum:e,pageSize:t,username:this.state.searchUsername,conditions:this.state.searchConditions};this.setState({loading:!0}),this.props.getUserList(x.Z.clearNull(n)).then((function(n){200===n.status?a.setState({data:n.data.list,total:n.data.total,pageNum:e,pageSize:t}):m.default.error(n.message),a.setState({loading:!1})})).catch((function(){a.setState({loading:!1})}))}}},{key:"searchUsernameChange",value:function(e){e.target.value.length<20&&this.setState({searchUsername:e.target.value})}},{key:"searchConditionsChange",value:function(e){this.setState({searchConditions:e})}},{key:"onSearch",value:function(){this.onGetData(this.state.pageNum,this.state.pageSize)}},{key:"onModalShow",value:function(e,t){var a=this;this.setState({modalShow:!0,nowData:e,operateType:t}),setTimeout((function(){"add"===t?a.form.current.resetFields():setTimeout((function(){a.form.current.setFieldsValue({formConditions:e.conditions,formDesc:e.desc,formUsername:e.username,formPhone:e.phone,formEmail:e.email,formPassword:e.password})}))}))}},{key:"onOk",value:(t=(0,d.Z)(C().mark((function e(){var t,a,n,r=this;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("see"!==this.state.operateType){e.next=3;break}return this.onClose(),e.abrupt("return");case 3:return e.prev=3,t=this,e.next=7,this.form.current.validateFields();case 7:a=e.sent,t.setState({modalLoading:!0}),n={username:a.formUsername,password:a.formPassword,phone:a.formPhone,email:a.formEmail,desc:a.formDesc,conditions:a.formConditions},"add"===this.state.operateType?t.props.addUser(n).then((function(e){200===e.status?(m.default.success("添加成功"),r.onGetData(r.state.pageNum,r.state.pageSize),r.onClose()):m.default.error(e.message),t.setState({modalLoading:!1})})).catch((function(){t.setState({modalLoading:!1})})):(n.id=this.state.nowData.id,t.props.upUser(n).then((function(e){200===e.status?(m.default.success("修改成功"),r.onGetData(r.state.pageNum,r.state.pageSize),r.onClose()):m.default.error(e.message),t.setState({modalLoading:!1})})).catch((function(){t.setState({modalLoading:!1})}))),e.next=15;break;case 13:e.prev=13,e.t0=e.catch(3);case 15:case"end":return e.stop()}}),e,this,[[3,13]])}))),function(){return t.apply(this,arguments)})},{key:"onDel",value:function(e){var t=this;this.setState({loading:!0}),this.props.delUser({id:e}).then((function(e){200===e.status?(m.default.success("删除成功"),t.onGetData(t.state.pageNum,t.state.pageSize)):(m.default.error(e.message),t.setState({loading:!1}))})).catch((function(){t.setState({loading:!1})}))}},{key:"onClose",value:function(){this.setState({modalShow:!1})}},{key:"onTreeShowClick",value:function(e){this.setState({nowData:e,roleTreeShow:!0,roleTreeDefault:e.roles||[]})}},{key:"onTablePageChange",value:function(e,t){this.onGetData(e,t)}},{key:"makeColumns",value:function(){var e=this;return[{title:"序号",dataIndex:"serial",key:"serial"},{title:"用户名",dataIndex:"username",key:"username"},{title:"电话",dataIndex:"phone",key:"phone"},{title:"邮箱",dataIndex:"email",key:"email"},{title:"描述",dataIndex:"desc",key:"desc"},{title:"状态",dataIndex:"conditions",key:"conditions",render:function(e,t){return 1===e?Z.createElement("span",{style:{color:"green"}},"启用"):Z.createElement("span",{style:{color:"red"}},"禁用")}},{title:"操作",key:"control",width:200,render:function(t,a){var n=[],r=e.props.userinfo.userBasicInfo||{},s=e.props.powersCode;s.includes("user:query")&&n.push(Z.createElement("span",{key:"0",className:"control-btn green",onClick:function(){return e.onModalShow(a,"see")}},Z.createElement(u.default,{placement:"top",title:"查看"},Z.createElement(S.Z,null)))),s.includes("user:up")&&n.push(Z.createElement("span",{key:"1",className:"control-btn blue",onClick:function(){return e.onModalShow(a,"up")}},Z.createElement(u.default,{placement:"top",title:"修改"},Z.createElement(D.Z,null)))),s.includes("user:role")&&n.push(Z.createElement("span",{key:"2",className:"control-btn blue",onClick:function(){return e.onTreeShowClick(a)}},Z.createElement(u.default,{placement:"top",title:"分配角色"},Z.createElement(T.Z,null)))),s.includes("user:del")&&r.id!==a.id&&n.push(Z.createElement(c.Z,{key:"3",title:"确定删除吗?",onConfirm:function(){return e.onDel(a.id)},okText:"确定",cancelText:"取消"},Z.createElement("span",{className:"control-btn red"},Z.createElement(u.default,{placement:"top",title:"删除"},Z.createElement(b.Z,null)))));var o=[];return n.forEach((function(e,t){t&&o.push(Z.createElement(i.Z,{key:"line".concat(t),type:"vertical"})),o.push(e)})),o}}]}},{key:"makeData",value:function(e){var t=this;return e.map((function(e,a){return{key:a,id:e.id,serial:a+1+(t.state.pageNum-1)*t.state.pageSize,username:e.username,password:e.password,phone:e.phone,email:e.email,desc:e.desc,conditions:e.conditions,control:e.id,roles:e.roles}}))}},{key:"onRoleOk",value:function(e,t){var a=this,n={id:this.state.nowData.id,roles:e.map((function(e){return Number(e)}))};this.setState({roleTreeLoading:!0}),this.props.upUser(n).then((function(e){200===e.status?(m.default.success("分配成功"),a.onGetData(a.state.pageNum,a.state.pageSize),a.onRoleClose()):m.default.error(e.message),a.setState({roleTreeLoading:!1})})).catch((function(){a.setState({roleTreeLoading:!1})}))}},{key:"onRoleClose",value:function(){this.setState({roleTreeShow:!1})}},{key:"render",value:function(){var e=this,t=this.props.powersCode,a={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}};return Z.createElement("div",null,Z.createElement("div",{className:"g-search"},Z.createElement("ul",{className:"search-func"},Z.createElement("li",null,Z.createElement(l.default,{type:"primary",icon:Z.createElement(N.Z,null),disabled:!t.includes("user:add"),onClick:function(){return e.onModalShow(null,"add")}},"添加用户"))),Z.createElement(i.Z,{type:"vertical"}),t.includes("user:query")&&Z.createElement("ul",{className:"search-ul"},Z.createElement("li",null,Z.createElement(k.Z,{placeholder:"请输入用户名",onChange:function(t){return e.searchUsernameChange(t)},value:this.state.searchUsername})),Z.createElement("li",null,Z.createElement(g.default,{placeholder:"请选择状态",allowClear:!0,style:{width:"200px"},onChange:function(t){return e.searchConditionsChange(t)},value:this.state.searchConditions},Z.createElement(A,{value:1},"启用"),Z.createElement(A,{value:-1},"禁用"))),Z.createElement("li",null,Z.createElement(l.default,{type:"primary",icon:Z.createElement(R.Z,null),onClick:function(){return e.onSearch()}},"搜索")))),Z.createElement("div",{className:"diy-table"},Z.createElement(o.Z,{columns:this.makeColumns(),loading:this.state.loading,dataSource:this.makeData(this.state.data),pagination:{total:this.state.total,current:this.state.pageNum,pageSize:this.state.pageSize,showQuickJumper:!0,showTotal:function(e,t){return"共 ".concat(e," 条数据")},onChange:function(t,a){return e.onTablePageChange(t,a)}}})),Z.createElement(n.Z,{title:{add:"新增",up:"修改",see:"查看"}[this.state.operateType],visible:this.state.modalShow,onOk:function(){return e.onOk()},onCancel:function(){return e.onClose()},confirmLoading:this.state.modalLoading},Z.createElement(r.Z,{ref:this.form,initialValues:{formConditions:1}},Z.createElement(r.Z.Item,(0,s.Z)({label:"用户名",name:"formUsername"},a,{rules:[{required:!0,whitespace:!0,message:"必填"},{max:12,message:"最多输入12位字符"}]}),Z.createElement(k.Z,{placeholder:"请输入用户名",disabled:"see"===this.state.operateType})),Z.createElement(r.Z.Item,(0,s.Z)({label:"密码",name:"formPassword"},a,{rules:[{required:!0,whitespace:!0,message:"必填"},{min:6,message:"最少输入6位字符"},{max:18,message:"最多输入18位字符"}]}),Z.createElement(k.Z,{type:"password",placeholder:"请输入密码",disabled:"see"===this.state.operateType})),Z.createElement(r.Z.Item,(0,s.Z)({label:"电话",name:"formPhone"},a,{rules:[function(){return{validator:function(e,t){var a=t;return a&&!x.Z.checkPhone(a)?Promise.reject("请输入有效的手机号码"):Promise.resolve()}}}]}),Z.createElement(k.Z,{placeholder:"请输入手机号",disabled:"see"===this.state.operateType})),Z.createElement(r.Z.Item,(0,s.Z)({label:"邮箱",name:"formEmail"},a,{rules:[function(){return{validator:function(e,t){var a=t;return a&&!x.Z.checkEmail(a)?Promise.reject("请输入有效的邮箱地址"):Promise.resolve()}}}]}),Z.createElement(k.Z,{placeholder:"请输入邮箱地址",disabled:"see"===this.state.operateType})),Z.createElement(r.Z.Item,(0,s.Z)({label:"描述",name:"formDesc"},a,{rules:[{max:100,message:"最多输入100个字符"}]}),Z.createElement(q,{rows:4,disabled:"see"===this.state.operateType,placeholoder:"请输入描述",autosize:{minRows:2,maxRows:6}})),Z.createElement(r.Z.Item,(0,s.Z)({label:"状态",name:"formConditions"},a,{rules:[{required:!0,message:"请选择状态"}]}),Z.createElement(g.default,{disabled:"see"===this.state.operateType},Z.createElement(A,{key:1,value:1},"启用"),Z.createElement(A,{key:-1,value:-1},"禁用"))))),Z.createElement(G,{title:"分配角色",data:this.state.roleData,visible:this.state.roleTreeShow,defaultKeys:this.state.roleTreeDefault,loading:this.state.roleTreeLoading,onOk:function(t){return e.onRoleOk(t)},onClose:function(){return e.onRoleClose()}}))}}]),y}(Z.Component))||K}}]);