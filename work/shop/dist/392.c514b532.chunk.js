"use strict";(self.webpackChunkreact_luo=self.webpackChunkreact_luo||[]).push([[392],{36531:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(44367),o=n(59496),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"},s=n(1719),i=function(e,t){return o.createElement(s.Z,(0,a.Z)((0,a.Z)({},e),{},{ref:t,icon:r}))};i.displayName="EditOutlined";var l=o.forwardRef(i)},74532:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(44367),o=n(59496),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},s=n(1719),i=function(e,t){return o.createElement(s.Z,(0,a.Z)((0,a.Z)({},e),{},{ref:t,icon:r}))};i.displayName="SearchOutlined";var l=o.forwardRef(i)},64138:function(e,t,n){n.r(t),n.d(t,{default:function(){return q}});n(83646);var a=n(85149),o=(n(97392),n(74572)),r=(n(22642),n(94099)),s=n(45443),i=(n(95760),n(79013)),l=(n(93542),n(41741)),c=(n(30153),n(11248)),u=(n(17510),n(7939)),d=(n(17652),n(27220)),h=n(34451),p=n(82173),f=(n(84113),n(66847)),m=n(81915),k=n(13475),y=n(76815),g=n(81072),v=n(13246),w=(n(78464),n(88390)),C=(n(17819),n(24996)),S=n(99700),E=n.n(S),D=n(59496),Z=n(18071),T=n(45589),b=n(14154),R=n(36531),x=n(27478),O=n(72423),I=n(74532),N=n(30796),A=(n(356),n(55149)),L=(n(19232),n(76606));n(32699);function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,v.Z)(e);if(t){var o=(0,v.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,g.Z)(this,n)}}var z,M=function(e){(0,y.Z)(n,e);var t=P(n);function n(e){var a;return(0,m.Z)(this,n),(a=t.call(this,e)).state={sourceData0:[],sourceData:[],btnDtoChecked:[],treeChecked:[]},a}return(0,k.Z)(n,[{key:"componentDidMount",value:function(){this.makeSourceData(this.props.data||[],{})}},{key:"componentDidUpdate",value:function(e){e.data===this.props.data&&e.defaultChecked===this.props.defaultChecked||this.makeSourceData(this.props.data,this.props.defaultChecked)}},{key:"onOk",value:function(){this.props.onOk&&this.props.onOk({menus:this.state.treeChecked,powers:this.state.btnDtoChecked})}},{key:"onClose",value:function(){this.props.onClose()}},{key:"init",value:function(){}},{key:"makeSourceData",value:function(e,t){var n=(0,h.Z)(e);n.sort((function(e,t){return e.sorts-t.sorts}));var a=this.dataToJson(null,n)||[],o=t.menus||[],r=t.powers||[];this.setState({sourceData0:e,sourceData:a,treeChecked:o,btnDtoChecked:r})}},{key:"dataToJson",value:function(e,t){var n,a=this;return(n=e?t.filter((function(t){return t.parent===e.id})):t.filter((function(e){return!e.parent}))).forEach((function(e){e.children=a.dataToJson(e,t),e.key=e.id})),n.length?n:null}},{key:"dtoIsChecked",value:function(e){return!!this.state.btnDtoChecked.find((function(t){return t===e}))}},{key:"makeColumns",value:function(){var e=this;return[{title:"菜单",dataIndex:"title",key:"title",width:"30%"},{title:"权限",dataIndex:"powers",key:"powers",width:"70%",render:function(t,n){if(t)return t.map((function(t,a){return D.createElement(L.default,{key:a,checked:e.dtoIsChecked(t.id),onChange:function(a){return e.onBtnDtoChange(a,t.id,n)}},t.title)}))}}]}},{key:"makeRowSelection",value:function(){var e=this;return{onChange:function(t,n){e.setState({treeChecked:t})},onSelect:function(t,n,a){var o=e.state.sourceData0.find((function(e){return e.id===t.id}));if(n){if(o&&Array.isArray(o.powers)){var r=Array.from(new Set([].concat((0,h.Z)(o.powers.map((function(e){return e.id}))),(0,h.Z)(e.state.btnDtoChecked))));e.setState({btnDtoChecked:r})}}else if(o&&Array.isArray(o.powers)){var s=o.powers.map((function(e){return e.id})),i=e.state.btnDtoChecked.filter((function(e){return s.indexOf(e)<0}));e.setState({btnDtoChecked:i})}},onSelectAll:function(t,n,a){t?e.setState({btnDtoChecked:e.state.sourceData0.reduce((function(e,t){return[].concat((0,h.Z)(e),(0,h.Z)(t.powers.map((function(e){return e.id}))))}),[])}):e.setState({btnDtoChecked:[]})},selectedRowKeys:this.state.treeChecked}}},{key:"onBtnDtoChange",value:function(e,t,n){var a=(0,h.Z)(this.state.btnDtoChecked),o=(0,h.Z)(this.state.treeChecked);if(e.target.checked)a.push(t),o=Array.from(new Set([n.id].concat((0,h.Z)(this.state.treeChecked))));else{a.splice(a.indexOf(t),1);var r=n.powers.map((function(e){return e.id}));this.state.btnDtoChecked.some((function(e){return e!==t&&r.indexOf(e)>=0}))||o.splice(o.indexOf(n.id),1)}this.setState({btnDtoChecked:a,treeChecked:o})}},{key:"render",value:function(){var e=this;return D.createElement(a.Z,{className:"menu-tree-table",zIndex:1001,width:750,title:this.props.title||"请选择",visible:this.props.modalShow,onOk:function(){return e.onOk()},onCancel:function(){return e.onClose()},confirmLoading:this.props.loading},this.props.initloading?D.createElement("div",{style:{textAlign:"center"}},D.createElement(A.default,{tip:"加载中…"})):D.createElement(i.Z,{columns:this.makeColumns(),rowSelection:this.makeRowSelection(),dataSource:this.state.sourceData,pagination:!1,defaultExpandAllRows:!0}))}}]),n}(D.PureComponent);function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,v.Z)(e);if(t){var o=(0,v.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,g.Z)(this,n)}}var G=C.Z.TextArea,U=w.default.Option,q=(0,Z.$j)((function(e){return{powersCode:e.app.powersCode,powerTreeData:e.sys.powerTreeData}}),(function(e){return{getAllPowers:e.sys.getAllPowers,getRoles:e.sys.getRoles,addRole:e.sys.addRole,upRole:e.sys.upRole,delRole:e.sys.delRole,setPowersByRoleId:e.sys.setPowersByRoleId,findAllPowerByRoleId:e.sys.findAllPowerByRoleId,updateUserInfo:e.app.updateUserInfo}}))(z=function(e){(0,y.Z)(g,e);var t,n=B(g);function g(e){var t;return(0,m.Z)(this,g),(t=n.call(this,e)).form=D.createRef(),t.state={data:[],operateType:"add",loading:!1,searchTitle:void 0,searchConditions:void 0,modalShow:!1,modalLoading:!1,nowData:null,powerTreeShow:!1,powerTreeDefault:{menus:[],powers:[]},pageNum:1,pageSize:10,total:0,treeLoading:!1,treeOnOkLoading:!1},t}return(0,k.Z)(g,[{key:"componentDidMount",value:function(){this.onGetData(this.state.pageNum,this.state.pageSize),this.onGetPowerTreeData()}},{key:"onGetPowerTreeData",value:function(){this.props.getAllPowers()}},{key:"onGetData",value:function(e,t){var n=this;if(this.props.powersCode.includes("role:query")){var a={pageNum:e,pageSize:t,title:this.state.searchTitle,conditions:this.state.searchConditions};this.setState({loading:!0}),this.props.getRoles(N.Z.clearNull(a)).then((function(a){200===a.status?n.setState({data:a.data.list,total:a.data.total,pageNum:e,pageSize:t}):f.default.error(a.message),n.setState({loading:!1})})).catch((function(){n.setState({loading:!1})}))}}},{key:"searchTitleChange",value:function(e){e.target.value.length<20&&this.setState({searchTitle:e.target.value})}},{key:"searchConditionsChange",value:function(e){this.setState({searchConditions:e})}},{key:"onSearch",value:function(){this.onGetData(this.state.pageNum,this.state.pageSize)}},{key:"onModalShow",value:function(e,t){var n=this;this.setState({modalShow:!0,nowData:e,operateType:t}),setTimeout((function(){"add"===t?n.form.current.resetFields():n.form.current.setFieldsValue({formConditions:e.conditions,formDesc:e.desc,formSorts:e.sorts,formTitle:e.title})}))}},{key:"onOk",value:(t=(0,p.Z)(E().mark((function e(){var t,n,a,o=this;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("see"!==this.state.operateType){e.next=3;break}return this.onClose(),e.abrupt("return");case 3:return e.prev=3,t=this,e.next=7,this.form.current.validateFields();case 7:n=e.sent,t.setState({modalLoading:!0}),a={title:n.formTitle,desc:n.formDesc,sorts:n.formSorts,conditions:n.formConditions},"add"===this.state.operateType?t.props.addRole(a).then((function(e){200===e.status?(f.default.success("添加成功"),o.onGetData(o.state.pageNum,o.state.pageSize),o.props.updateUserInfo(),o.onClose()):f.default.error(e.message),t.setState({modalLoading:!1})})).catch((function(){t.setState({modalLoading:!1})})):(a.id=this.state.nowData.id,t.props.upRole(a).then((function(e){200===e.status?(f.default.success("修改成功"),o.onGetData(o.state.pageNum,o.state.pageSize),o.props.updateUserInfo(),o.onClose()):f.default.error(e.message),t.setState({modalLoading:!1})})).catch((function(){t.setState({modalLoading:!1})}))),e.next=15;break;case 13:e.prev=13,e.t0=e.catch(3);case 15:case"end":return e.stop()}}),e,this,[[3,13]])}))),function(){return t.apply(this,arguments)})},{key:"onDel",value:function(e){var t=this;this.setState({loading:!0}),this.props.delRole({id:e}).then((function(e){200===e.status?(f.default.success("删除成功"),t.onGetData(t.state.pageNum,t.state.pageSize),t.props.updateUserInfo()):(f.default.error(e.message),t.setState({loading:!1}))})).catch((function(){t.setState({loading:!1})}))}},{key:"onClose",value:function(){this.setState({modalShow:!1})}},{key:"onAllotPowerClick",value:function(e){var t=e.menuAndPowers.map((function(e){return e.menuId})),n=e.menuAndPowers.reduce((function(e,t){return[].concat((0,h.Z)(e),(0,h.Z)(t.powers))}),[]);this.setState({nowData:e,powerTreeShow:!0,powerTreeDefault:{menus:t,powers:n}})}},{key:"onMenuTreeClose",value:function(){this.setState({powerTreeShow:!1})}},{key:"onMenuTreeOk",value:function(e){var t=this,n={id:this.state.nowData.id,menus:e.menus,powers:e.powers};this.setState({treeOnOkLoading:!0}),this.props.setPowersByRoleId(n).then((function(e){200===e.status?(t.onGetData(t.state.pageNum,t.state.pageSize),t.props.updateUserInfo(),t.onMenuTreeClose()):f.default.error(e.message||"权限分配失败"),t.setState({treeOnOkLoading:!1})})).catch((function(){t.setState({treeOnOkLoading:!1})}))}},{key:"onTablePageChange",value:function(e,t){this.onGetData(e,t)}},{key:"makeColumns",value:function(){var e=this;return[{title:"序号",dataIndex:"serial",key:"serial"},{title:"角色名",dataIndex:"title",key:"title"},{title:"描述",dataIndex:"desc",key:"desc"},{title:"排序",dataIndex:"sorts",key:"sorts"},{title:"状态",dataIndex:"conditions",key:"conditions",render:function(e,t){return 1===e?D.createElement("span",{style:{color:"green"}},"启用"):D.createElement("span",{style:{color:"red"}},"禁用")}},{title:"操作",key:"control",width:200,render:function(t,n){var a=[],o=e.props.powersCode;o.includes("role:query")&&a.push(D.createElement("span",{key:"0",className:"control-btn green",onClick:function(){return e.onModalShow(n,"see")}},D.createElement(d.default,{placement:"top",title:"查看"},D.createElement(T.Z,null)))),o.includes("role:up")&&a.push(D.createElement("span",{key:"1",className:"control-btn blue",onClick:function(){return e.onModalShow(n,"up")}},D.createElement(d.default,{placement:"top",title:"修改"},D.createElement(b.Z,null)))),o.includes("role:power")&&a.push(D.createElement("span",{key:"2",className:"control-btn blue",onClick:function(){return e.onAllotPowerClick(n)}},D.createElement(d.default,{placement:"top",title:"分配权限"},D.createElement(R.Z,null)))),o.includes("role:del")&&a.push(D.createElement(u.Z,{key:"3",title:"确定删除吗?",onConfirm:function(){return e.onDel(n.id)},okText:"确定",cancelText:"取消"},D.createElement("span",{className:"control-btn red"},D.createElement(d.default,{placement:"top",title:"删除"},D.createElement(x.Z,null)))));var r=[];return a.forEach((function(e,t){t&&r.push(D.createElement(c.Z,{key:"line".concat(t),type:"vertical"})),r.push(e)})),r}}]}},{key:"makeData",value:function(e){var t=this;return e.map((function(e,n){return{key:n,id:e.id,serial:n+1+(t.state.pageNum-1)*t.state.pageSize,title:e.title,desc:e.desc,sorts:e.sorts,conditions:e.conditions,control:e.id,menuAndPowers:e.menuAndPowers}}))}},{key:"render",value:function(){var e=this,t=this.props.powersCode,n={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}};return D.createElement("div",null,D.createElement("div",{className:"g-search"},D.createElement("ul",{className:"search-func"},D.createElement("li",null,D.createElement(l.default,{type:"primary",icon:D.createElement(O.Z,null),disabled:!t.includes("role:add"),onClick:function(){return e.onModalShow(null,"add")}},"添加角色"))),D.createElement(c.Z,{type:"vertical"}),t.includes("role:query")&&D.createElement("ul",{className:"search-ul"},D.createElement("li",null,D.createElement(C.Z,{placeholder:"请输入角色名",onChange:function(t){return e.searchTitleChange(t)},value:this.state.searchTitle})),D.createElement("li",null,D.createElement(w.default,{placeholder:"请选择状态",allowClear:!0,style:{width:"200px"},onChange:function(t){return e.searchConditionsChange(t)},value:this.state.searchConditions},D.createElement(U,{value:1},"启用"),D.createElement(U,{value:-1},"禁用"))),D.createElement("li",null,D.createElement(l.default,{type:"primary",icon:D.createElement(I.Z,null),onClick:function(){return e.onSearch()}},"搜索")))),D.createElement("div",{className:"diy-table"},D.createElement(i.Z,{columns:this.makeColumns(),loading:this.state.loading,dataSource:this.makeData(this.state.data),pagination:{total:this.state.total,current:this.state.pageNum,pageSize:this.state.pageSize,showQuickJumper:!0,showTotal:function(e,t){return"共 ".concat(e," 条数据")},onChange:function(t,n){return e.onTablePageChange(t,n)}}})),D.createElement(a.Z,{title:{add:"新增",up:"修改",see:"查看"}[this.state.operateType],visible:this.state.modalShow,onOk:function(){return e.onOk()},onCancel:function(){return e.onClose()},confirmLoading:this.state.modalLoading},D.createElement(r.Z,{ref:this.form,initialValues:{formConditions:1}},D.createElement(r.Z.Item,(0,s.Z)({label:"角色名",name:"formTitle"},n,{rules:[{required:!0,whitespace:!0,message:"必填"},{max:12,message:"最多输入12位字符"}]}),D.createElement(C.Z,{placeholder:"请输入角色名",disabled:"see"===this.state.operateType})),D.createElement(r.Z.Item,(0,s.Z)({label:"描述",name:"formDesc"},n,{rules:[{max:100,message:"最多输入100个字符"}]}),D.createElement(G,{rows:4,disabled:"see"===this.state.operateType,placeholoder:"请输入描述",autosize:{minRows:2,maxRows:6}})),D.createElement(r.Z.Item,(0,s.Z)({label:"排序",name:"formSorts"},n,{rules:[{required:!0,message:"请输入排序号"}]}),D.createElement(o.Z,{min:0,max:99999,style:{width:"100%"},disabled:"see"===this.state.operateType})),D.createElement(r.Z.Item,(0,s.Z)({label:"状态",name:"formConditions"},n,{rules:[{required:!0,message:"请选择状态"}]}),D.createElement(w.default,{disabled:"see"===this.state.operateType},D.createElement(U,{key:1,value:1},"启用"),D.createElement(U,{key:-1,value:-1},"禁用"))))),D.createElement(M,{title:this.state.nowData?"分配权限：".concat(this.state.nowData.title):"分配权限",data:this.props.powerTreeData,defaultChecked:this.state.powerTreeDefault,initloading:this.state.treeLoading,loading:this.state.treeOnOkLoading,modalShow:this.state.powerTreeShow,onOk:function(t){return e.onMenuTreeOk(t)},onClose:function(){return e.onMenuTreeClose()}}))}}]),g}(D.Component))||z}}]);