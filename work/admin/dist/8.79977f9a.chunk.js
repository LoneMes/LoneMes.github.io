(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{638:function(e,t,n){},649:function(e,t,n){"use strict";var a=n(0),r={name:"edit",theme:"outlined",icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]}},o=n(7),l=function(e,t){return a.createElement(o.a,Object.assign({},e,{ref:t,icon:r}))};l.displayName="EditOutlined";t.a=a.forwardRef(l)},650:function(e,t,n){"use strict";var a=n(0),r={name:"search",theme:"outlined",icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]}},o=n(7),l=function(e,t){return a.createElement(o.a,Object.assign({},e,{ref:t,icon:r}))};l.displayName="SearchOutlined";t.a=a.forwardRef(l)},660:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(38),l=n(653),i=n(657),s=n(347),c=n.n(s),u=(n(342),n(158)),d=n.n(u),f=(n(159),n(344)),p=n.n(f),m=(n(343),n(351)),w=n.n(m),h=(n(340),n(3)),y=n.n(h),v=(n(59),n(364)),g=n.n(v),b=(n(356),n(339)),E=n.n(b),k=(n(336),n(51)),O=n.n(k),C=(n(107),n(365)),S=n.n(C),x=(n(357),n(337)),T=n.n(x),I=(n(341),n(384)),j=n.n(I),A=(n(369),n(662)),R=n(661),N=n(649),D=n(664),z=n(658),L=n(650),P=(n(638),n(61)),M=n(353),B=n.n(M),q=(n(355),n(413)),U=n.n(q),F=(n(386),function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],l=0,i=o.length;l<i;l++,r++)a[r]=o[l];return a});function J(e){var t=Object(a.useState)([]),n=t[0],o=t[1],l=Object(a.useState)([]),i=l[0],s=l[1];Object(a.useEffect)((function(){o(e.defaultChecked.menus||[]),s(e.defaultChecked.powers||[])}),[e.defaultChecked]);var c=Object(a.useCallback)((function(){e.onOk&&e.onOk({menus:n,powers:i})}),[e,i,n]),u=Object(a.useCallback)((function(){e.onClose()}),[e]),d=Object(a.useCallback)((function(e){return!!i.find((function(t){return t===e}))}),[i]),f=Object(a.useCallback)((function(e,t,a){var r=F(i),l=F(n);if(e.target.checked)r.push(t),l=Array.from(new Set(F([a.id],n)));else{r.splice(r.indexOf(t),1);var c=a.powers.map((function(e){return e.id}));i.some((function(e){return e!==t&&c.indexOf(e)>=0}))||l.splice(l.indexOf(a.id),1)}s(r),o(l)}),[i,n]),p=Object(a.useCallback)((function(e,t){var n;return(n=e?t.filter((function(t){return t.parent===e.id})):t.filter((function(e){return!e.parent}))).forEach((function(e){e.children=p(e,t),e.key=e.id})),n.length?n:null}),[]),m=Object(a.useMemo)((function(){var t=F(e.data);return t.sort((function(e,t){return e.sorts-t.sorts})),p(null,t)||[]}),[e.data,p]),h=Object(a.useMemo)((function(){return{onChange:function(e){o(e)},onSelect:function(t,n){var a=e.data.find((function(e){return e.id===t.id}));if(n){if(a&&Array.isArray(a.powers)){var r=Array.from(new Set(F(a.powers.map((function(e){return e.id})),i)));s(r)}}else if(a&&Array.isArray(a.powers)){var o=a.powers.map((function(e){return e.id}));r=i.filter((function(e){return o.indexOf(e)<0}));s(r)}},onSelectAll:function(t){s(t?e.data.reduce((function(e,t){return F(e,t.powers.map((function(e){return e.id})))}),[]):[])},selectedRowKeys:n}}),[e.data,n,i]),y=Object(a.useMemo)((function(){return[{title:"菜单",dataIndex:"title",key:"title",width:"30%"},{title:"权限",dataIndex:"powers",key:"powers",width:"70%",render:function(e,t){return e?e.map((function(e,n){return r.a.createElement(B.a,{key:n,checked:d(e.id),onChange:function(n){return f(n,e.id,t)}},e.title)})):null}}]}),[d,f]);return r.a.createElement(E.a,{className:"menu-tree-table",zIndex:1001,width:750,title:e.title||"请选择",visible:e.modalShow,onOk:c,onCancel:u,confirmLoading:e.loading},e.initloading?r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement(U.a,{tip:"加载中…"})):r.a.createElement(w.a,{columns:y,rowSelection:h,dataSource:m,pagination:!1,defaultExpandAllRows:!0}))}var V=function(){return(V=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},G=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function l(e){try{s(a.next(e))}catch(e){o(e)}}function i(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,i)}s((a=a.apply(e,t||[])).next())}))},H=function(e,t){var n,a,r,o,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,a=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(r=l.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){l.label=o[1];break}if(6===o[0]&&l.label<r[1]){l.label=r[1],r=o;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(o);break}r[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},K=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],l=0,i=o.length;l<i;l++,r++)a[r]=o[l];return a},Q=p.a.TextArea,W=T.a.Option,X={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}};t.default=Object(o.b)((function(e){return{powersCode:e.app.powersCode,powerTreeData:e.sys.powerTreeData}}),(function(e){return{getAllMenusAndPowers:e.sys.getAllMenusAndPowers,getRoles:e.sys.getRoles,addRole:e.sys.addRole,upRole:e.sys.upRole,delRole:e.sys.delRole,setPowersByRoleId:e.sys.setPowersByRoleId,findAllPowerByRoleId:e.sys.findAllPowerByRoleId,updateUserInfo:e.app.updateUserInfo}}))((function(e){var t=this,n=e.powersCode,o=c.a.useForm()[0],s=Object(a.useState)([]),u=s[0],f=s[1],m=Object(a.useState)(!1),h=m[0],v=m[1],b=Object(l.a)({pageNum:1,pageSize:10,total:0}),k=b[0],C=b[1],x=Object(l.a)({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),I=x[0],M=x[1],B=Object(l.a)({title:void 0,conditions:void 0}),q=B[0],U=B[1],F=Object(l.a)({treeOnOkLoading:!1,powerTreeShow:!1,powerTreeDefault:{menus:[],powers:[]}}),Y=F[0],Z=F[1];Object(i.a)((function(){_(k),$()}));var $=function(){e.getAllMenusAndPowers()},_=function(n){return G(t,void 0,void 0,(function(){var t,a,r;return H(this,(function(o){switch(o.label){case 0:if(!e.powersCode.includes("role:query"))return[2];t={pageNum:n.pageNum,pageSize:n.pageSize,title:q.title,conditions:q.conditions},v(!0),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,e.getRoles(P.a.clearNull(t))];case 2:return(a=o.sent())&&200===a.status?(f(a.data.list),C({total:a.data.total,pageNum:n.pageNum,pageSize:n.pageSize})):y.a.error(null!==(r=null==a?void 0:a.message)&&void 0!==r?r:"获取失败"),[3,4];case 3:return v(!1),[7];case 4:return[2]}}))}))},ee=function(e,t){M({modalShow:!0,nowData:e,operateType:t}),setTimeout((function(){"add"===t?o.resetFields():o.setFieldsValue({formConditions:null==e?void 0:e.conditions,formDesc:null==e?void 0:e.desc,formSorts:null==e?void 0:e.sorts,formTitle:null==e?void 0:e.title})}))},te=function(){M({modalShow:!1})},ne=function(){Z({powerTreeShow:!1})},ae=function(e,t){_({pageNum:e,pageSize:t||k.pageSize})},re=[{title:"序号",dataIndex:"serial",key:"serial"},{title:"角色名",dataIndex:"title",key:"title"},{title:"描述",dataIndex:"desc",key:"desc"},{title:"排序",dataIndex:"sorts",key:"sorts"},{title:"状态",dataIndex:"conditions",key:"conditions",render:function(e,t){return 1===e?r.a.createElement("span",{style:{color:"green"}},"启用"):r.a.createElement("span",{style:{color:"red"}},"禁用")}},{title:"操作",key:"control",width:200,render:function(a,o){var l=[];n.includes("role:query")&&l.push(r.a.createElement("span",{key:"0",className:"control-btn green",onClick:function(){return ee(o,"see")}},r.a.createElement(O.a,{placement:"top",title:"查看"},r.a.createElement(A.a,null)))),n.includes("role:up")&&l.push(r.a.createElement("span",{key:"1",className:"control-btn blue",onClick:function(){return ee(o,"up")}},r.a.createElement(O.a,{placement:"top",title:"修改"},r.a.createElement(R.a,null)))),n.includes("role:power")&&l.push(r.a.createElement("span",{key:"2",className:"control-btn blue",onClick:function(){return function(e){var t=e.menuAndPowers.map((function(e){return e.menuId})),n=e.menuAndPowers.reduce((function(e,t){return K(e,t.powers)}),[]);M({nowData:e}),Z({powerTreeShow:!0,powerTreeDefault:{menus:t,powers:n}})}(o)}},r.a.createElement(O.a,{placement:"top",title:"分配权限"},r.a.createElement(N.a,null)))),n.includes("role:del")&&l.push(r.a.createElement(g.a,{key:"3",title:"确定删除吗?",onConfirm:function(){return n=o.id,G(t,void 0,void 0,(function(){var t,a;return H(this,(function(r){switch(r.label){case 0:v(!0),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,e.delRole({id:n})];case 2:return(t=r.sent())&&200===t.status?(y.a.success("删除成功"),_(k),e.updateUserInfo()):y.a.error(null!==(a=null==t?void 0:t.message)&&void 0!==a?a:"操作失败"),[3,4];case 3:return v(!1),[7];case 4:return[2]}}))}));var n},okText:"确定",cancelText:"取消"},r.a.createElement("span",{className:"control-btn red"},r.a.createElement(O.a,{placement:"top",title:"删除"},r.a.createElement(D.a,null)))));var i=[];return l.forEach((function(e,t){t&&i.push(r.a.createElement(S.a,{key:"line"+t,type:"vertical"})),i.push(e)})),i}}],oe=Object(a.useMemo)((function(){return u.map((function(e,t){return{key:t,id:e.id,serial:t+1+(k.pageNum-1)*k.pageSize,title:e.title,desc:e.desc,sorts:e.sorts,conditions:e.conditions,control:e.id,menuAndPowers:e.menuAndPowers}}))}),[k,u]);return r.a.createElement("div",null,r.a.createElement("div",{className:"g-search"},r.a.createElement("ul",{className:"search-func"},r.a.createElement("li",null,r.a.createElement(d.a,{type:"primary",icon:r.a.createElement(z.a,null),disabled:!n.includes("role:add"),onClick:function(){return ee(null,"add")}},"添加角色"))),r.a.createElement(S.a,{type:"vertical"}),n.includes("role:query")&&r.a.createElement("ul",{className:"search-ul"},r.a.createElement("li",null,r.a.createElement(p.a,{placeholder:"请输入角色名",onChange:function(e){e.target.value.length<20&&U({title:e.target.value})},value:q.title})),r.a.createElement("li",null,r.a.createElement(T.a,{placeholder:"请选择状态",allowClear:!0,style:{width:"200px"},onChange:function(e){U({conditions:e})},value:q.conditions},r.a.createElement(W,{value:1},"启用"),r.a.createElement(W,{value:-1},"禁用"))),r.a.createElement("li",null,r.a.createElement(d.a,{type:"primary",icon:r.a.createElement(L.a,null),onClick:function(){_(k)}},"搜索")))),r.a.createElement("div",{className:"diy-table"},r.a.createElement(w.a,{columns:re,loading:h,dataSource:oe,pagination:{total:k.total,current:k.pageNum,pageSize:k.pageSize,showQuickJumper:!0,showTotal:function(e,t){return"共 "+e+" 条数据"},onChange:function(e,t){return ae(e,t)}}})),r.a.createElement(E.a,{title:{add:"新增",up:"修改",see:"查看"}[I.operateType],visible:I.modalShow,onOk:function(){return G(t,void 0,void 0,(function(){var t,n,a,r;return H(this,(function(l){switch(l.label){case 0:if("see"===I.operateType)return te(),[2];l.label=1;case 1:return l.trys.push([1,12,,13]),[4,o.validateFields()];case 2:if(t=l.sent(),M({modalLoading:!0}),n={title:t.formTitle,desc:t.formDesc,sorts:t.formSorts,conditions:t.formConditions},"add"!==I.operateType)return[3,7];l.label=3;case 3:return l.trys.push([3,,5,6]),[4,e.addRole(n)];case 4:return(a=l.sent())&&200===a.status&&(y.a.success("添加成功"),_(k),e.updateUserInfo(),te()),[3,6];case 5:return M({modalLoading:!1}),[7];case 6:return[3,11];case 7:n.id=null===(r=null==I?void 0:I.nowData)||void 0===r?void 0:r.id,l.label=8;case 8:return l.trys.push([8,,10,11]),[4,e.upRole(n)];case 9:return(a=l.sent())&&200===a.status&&(y.a.success("修改成功"),_(k),e.updateUserInfo(),te()),[3,11];case 10:return M({modalLoading:!1}),[7];case 11:return[3,13];case 12:return l.sent(),[3,13];case 13:return[2]}}))}))},onCancel:function(){return te()},confirmLoading:I.modalLoading},r.a.createElement(c.a,{form:o,initialValues:{formConditions:1}},r.a.createElement(c.a.Item,V({label:"角色名",name:"formTitle"},X,{rules:[{required:!0,whitespace:!0,message:"必填"},{max:12,message:"最多输入12位字符"}]}),r.a.createElement(p.a,{placeholder:"请输入角色名",disabled:"see"===I.operateType})),r.a.createElement(c.a.Item,V({label:"描述",name:"formDesc"},X,{rules:[{max:100,message:"最多输入100个字符"}]}),r.a.createElement(Q,{rows:4,disabled:"see"===I.operateType,autoSize:{minRows:2,maxRows:6}})),r.a.createElement(c.a.Item,V({label:"排序",name:"formSorts"},X,{rules:[{required:!0,message:"请输入排序号"}]}),r.a.createElement(j.a,{min:0,max:99999,style:{width:"100%"},disabled:"see"===I.operateType})),r.a.createElement(c.a.Item,V({label:"状态",name:"formConditions"},X,{rules:[{required:!0,message:"请选择状态"}]}),r.a.createElement(T.a,{disabled:"see"===I.operateType},r.a.createElement(W,{key:1,value:1},"启用"),r.a.createElement(W,{key:-1,value:-1},"禁用"))))),r.a.createElement(J,{title:I.nowData?"分配权限："+I.nowData.title:"分配权限",data:e.powerTreeData,defaultChecked:Y.powerTreeDefault,loading:Y.treeOnOkLoading,modalShow:Y.powerTreeShow,onOk:function(n){return G(t,void 0,void 0,(function(){var t,a,r,o;return H(this,(function(l){switch(l.label){case 0:if(!(null===(r=null==I?void 0:I.nowData)||void 0===r?void 0:r.id))return y.a.error("该数据没有ID"),[2];t={id:I.nowData.id,menus:n.menus,powers:n.powers},Z({treeOnOkLoading:!0}),l.label=1;case 1:return l.trys.push([1,,3,4]),[4,e.setPowersByRoleId(t)];case 2:return(a=l.sent())&&200===a.status?(_(k),e.updateUserInfo(),ne()):y.a.error(null!==(o=null==a?void 0:a.message)&&void 0!==o?o:"权限分配失败"),[3,4];case 3:return Z({treeOnOkLoading:!1}),[7];case 4:return[2]}}))}))},onClose:ne}))}))}}]);