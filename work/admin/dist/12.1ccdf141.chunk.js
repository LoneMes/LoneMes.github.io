(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{441:function(e,n,t){},663:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(653),c=t(657),i=t(38),l=t(374),s=t.n(l),u=(t(368),t(158)),d=t.n(u),m=(t(159),t(351)),p=t.n(m),f=(t(340),t(51)),y=t.n(f),b=(t(107),t(364)),h=t.n(b),E=(t(356),t(339)),v=t.n(E),w=(t(336),t(347)),k=t.n(w),g=(t(342),t(337)),x=t.n(g),I=(t(341),t(344)),T=t.n(I),C=(t(343),t(384)),S=t.n(C),O=(t(369),t(3)),j=t.n(O),M=(t(59),t(365)),N=t.n(M),U=(t(357),t(662)),D=t(661),q=t(664),L=t(658),F=t(115),J=(t(441),["icon-Dollar","icon-compass","icon-EURO","icon-time-circle","icon-earth","icon-YUAN","icon-message","icon-dashboard","icon-piechart","icon-setting","icon-eye","icon-save","icon-appstore","icon-control","icon-detail","icon-project","icon-wallet","icon-user","icon-team","icon-areachart","icon-linechart","icon-barchart","icon-pointmap","icon-database","icon-reconciliation","icon-securityscan","icon-propertysafety","icon-safetycertificate","icon-alert","icon-bulb","icon-trophy","icon-USB","icon-home","icon-like","icon-unlock","icon-lock","icon-customerservice","icon-flag","icon-moneycollect","icon-medicinebox","icon-shop","icon-rocket","icon-shopping","icon-folder","icon-folder-open","icon-sliders","icon-cloud","icon-crown","icon-desktop","icon-gift"]),R=t(99),A=function(){return(A=Object.assign||function(e){for(var n,t=1,a=arguments.length;t<a;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},B=function(e,n,t,a){return new(t||(t=Promise))((function(r,o){function c(e){try{l(a.next(e))}catch(e){o(e)}}function i(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(c,i)}l((a=a.apply(e,n||[])).next())}))},K=function(e,n){var t,a,r,o,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;c;)try{if(t=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return c.label++,{value:o[1],done:!1};case 5:c.label++,a=o[1],o=[0];continue;case 7:o=c.ops.pop(),c.trys.pop();continue;default:if(!(r=c.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){c=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){c.label=o[1];break}if(6===o[0]&&c.label<r[1]){c.label=r[1],r=o;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(o);break}r[2]&&c.ops.pop(),c.trys.pop();continue}o=n.call(e,c)}catch(e){o=[6,e],a=0}finally{t=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},P=x.a.Option,V=T.a.TextArea,z={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}};n.default=Object(i.b)((function(e){return{roles:e.sys.roles,powersCode:e.app.powersCode}}),(function(e){return{addMenu:e.sys.addMenu,getMenus:e.sys.getMenus,upMenu:e.sys.upMenu,delMenu:e.sys.delMenu,updateUserInfo:e.app.updateUserInfo}}))((function(e){var n=this,t=e.powersCode,i=k.a.useForm()[0],l=Object(a.useState)([]),u=l[0],m=l[1],f=Object(a.useState)(!1),b=f[0],E=f[1],w=Object(o.a)({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),g=w[0],I=w[1],C=Object(a.useState)({}),O=C[0],M=C[1];Object(c.a)((function(){G()}));var G=function(){return B(n,void 0,void 0,(function(){var n;return K(this,(function(t){switch(t.label){case 0:if(!e.powersCode.includes("menu:query"))return[2];E(!0),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,e.getMenus()];case 2:return(n=t.sent())&&200===n.status&&m(n.data),[3,4];case 3:return E(!1),[7];case 4:return[2]}}))}))},Q=Object(a.useCallback)((function(e,n){var t;return(t=e?n.filter((function(n){return n.parent===e.id})):n.filter((function(e){return!e.parent}))).forEach((function(e){return e.children=Q(e,n)})),t.length?t:null}),[]),Y=Object(a.useCallback)((function(e,n){var t={};n.selected&&(t={title:n.node.title,id:n.node.id}),M(t)}),[]),H=function(e,n){I({modalShow:!0,nowData:e,operateType:n}),setTimeout((function(){"add"===n?i.resetFields():e&&i.setFieldsValue({formConditions:e.conditions,formDesc:e.desc,formIcon:e.icon,formSorts:e.sorts,formTitle:e.title,formUrl:e.url})}))},W=function(){I({modalShow:!1})},X=Object(a.useMemo)((function(){var e=Object(F.cloneDeep)(u);return e.forEach((function(e){e.key=String(e.id)})),e.sort((function(e,n){return e.sorts-n.sorts})),Q(null,e)||[]}),[u,Q]),Z=[{title:"序号",dataIndex:"serial",key:"serial"},{title:"图标",dataIndex:"icon",key:"icon",render:function(e){return e?r.a.createElement(R.a,{type:e}):""}},{title:"菜单名称",dataIndex:"title",key:"title"},{title:"路径",dataIndex:"url",key:"url",render:function(e){return e?"/"+e.replace(/^\//,""):""}},{title:"描述",dataIndex:"desc",key:"desc"},{title:"父级",dataIndex:"parent",key:"parent",render:function(e){return function(e){var n=u.find((function(n){return n.id===e}));return n?n.title:void 0}(e)}},{title:"状态",dataIndex:"conditions",key:"conditions",render:function(e){return 1===e?r.a.createElement("span",{style:{color:"green"}},"启用"):r.a.createElement("span",{style:{color:"red"}},"禁用")}},{title:"操作",key:"control",width:120,render:function(t,a){var o=e.powersCode,c=[];o.includes("menu:query")&&c.push(r.a.createElement("span",{key:"0",className:"control-btn green",onClick:function(){return H(a,"see")}},r.a.createElement(y.a,{placement:"top",title:"查看"},r.a.createElement(U.a,null)))),o.includes("menu:up")&&c.push(r.a.createElement("span",{key:"1",className:"control-btn blue",onClick:function(){return H(a,"up")}},r.a.createElement(y.a,{placement:"top",title:"修改"},r.a.createElement(D.a,null)))),o.includes("menu:del")&&c.push(r.a.createElement(h.a,{key:"2",title:"确定删除吗?",okText:"确定",cancelText:"取消",onConfirm:function(){return function(t){return B(n,void 0,void 0,(function(){var n,a,r;return K(this,(function(o){switch(o.label){case 0:return n={id:t.id},[4,e.delMenu(n)];case 1:return(a=o.sent())&&200===a.status?(G(),e.updateUserInfo(),j.a.success("删除成功")):j.a.error(null!==(r=null==a?void 0:a.message)&&void 0!==r?r:"操作失败"),[2]}}))}))}(a)}},r.a.createElement("span",{className:"control-btn red"},r.a.createElement(y.a,{placement:"top",title:"删除"},r.a.createElement(q.a,null)))));var i=[];return c.forEach((function(e,n){n&&i.push(r.a.createElement(N.a,{key:"line"+n,type:"vertical"})),i.push(e)})),i}}],$=Object(a.useMemo)((function(){return u.filter((function(e){return e.parent===(Number(O.id)||null)})).map((function(e,n){return{key:n,id:e.id,icon:e.icon,parent:e.parent,title:e.title,url:e.url,desc:e.desc,sorts:e.sorts,conditions:e.conditions,serial:n+1}}))}),[u,O.id]);return r.a.createElement("div",{className:"page-menu-admin"},r.a.createElement("div",{className:"l"},r.a.createElement("div",{className:"title"},"目录结构"),r.a.createElement("div",null,r.a.createElement(s.a,{defaultExpandedKeys:["0"],onSelect:Y,selectedKeys:[String(O.id)],treeData:X}))),r.a.createElement("div",{className:"r"},r.a.createElement("div",{className:"searchBox"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(d.a,{type:"primary",icon:r.a.createElement(L.a,null),onClick:function(){return H(null,"add")},disabled:!t.includes("menu:add")},"添加"+(O.title||"根级")+"子菜单")))),r.a.createElement(p.a,{className:"diy-table",columns:Z,loading:b,dataSource:$,pagination:{showQuickJumper:!0,showTotal:function(e){return"共 "+e+" 条数据"}}})),r.a.createElement(v.a,{title:""+{add:"新增",up:"修改",see:"查看"}[g.operateType],visible:g.modalShow,onOk:function(){return B(n,void 0,void 0,(function(){var n,t,a,r;return K(this,(function(o){switch(o.label){case 0:if("see"===g.operateType)return W(),[2];o.label=1;case 1:return o.trys.push([1,11,,12]),[4,i.validateFields()];case 2:if(n=o.sent(),t={title:n.formTitle,url:n.formUrl,icon:n.formIcon,parent:Number(O.id)||null,sorts:n.formSorts,desc:n.formDesc,conditions:n.formConditions},I({modalLoading:!0}),"add"!==g.operateType)return[3,7];o.label=3;case 3:return o.trys.push([3,,5,6]),[4,e.addMenu(t)];case 4:return(a=o.sent())&&200===a.status?(j.a.success("添加成功"),G(),W(),e.updateUserInfo()):j.a.error("添加失败"),[3,6];case 5:return I({modalLoading:!1}),[7];case 6:return[3,10];case 7:return o.trys.push([7,,9,10]),t.id=null===(r=null==g?void 0:g.nowData)||void 0===r?void 0:r.id,[4,e.upMenu(t)];case 8:return(a=o.sent())&&200===a.status?(j.a.success("修改成功"),G(),W(),e.updateUserInfo()):j.a.error("修改失败"),[3,10];case 9:return I({modalLoading:!1}),[7];case 10:return[3,12];case 11:return o.sent(),[3,12];case 12:return[2]}}))}))},onCancel:W,confirmLoading:g.modalLoading},r.a.createElement(k.a,{form:i,initialValues:{formConditions:1}},r.a.createElement(k.a.Item,A({label:"菜单名",name:"formTitle"},z,{rules:[{required:!0,whitespace:!0,message:"必填"},{max:12,message:"最多输入12位字符"}]}),r.a.createElement(T.a,{placeholder:"请输入菜单名",disabled:"see"===g.operateType})),r.a.createElement(k.a.Item,A({label:"菜单链接",name:"formUrl"},z,{rules:[{required:!0,whitespace:!0,message:"必填"}]}),r.a.createElement(T.a,{placeholder:"请输入菜单链接",disabled:"see"===g.operateType})),r.a.createElement(k.a.Item,A({label:"图标",name:"formIcon"},z),r.a.createElement(x.a,{dropdownClassName:"iconSelect",disabled:"see"===g.operateType},J.map((function(e,n){return r.a.createElement(P,{key:n,value:e},r.a.createElement(R.a,{type:e}))})))),r.a.createElement(k.a.Item,A({label:"描述",name:"formDesc"},z,{rules:[{max:100,message:"最多输入100位字符"}]}),r.a.createElement(V,{rows:4,disabled:"see"===g.operateType,autoSize:{minRows:2,maxRows:6}})),r.a.createElement(k.a.Item,A({label:"排序",name:"formSorts"},z,{rules:[{required:!0,message:"请输入排序号"}]}),r.a.createElement(S.a,{min:0,max:99999,style:{width:"100%"},disabled:"see"===g.operateType})),r.a.createElement(k.a.Item,A({label:"状态",name:"formConditions"},z,{rules:[{required:!0,message:"请选择状态"}]}),r.a.createElement(x.a,{disabled:"see"===g.operateType},r.a.createElement(P,{key:1,value:1},"启用"),r.a.createElement(P,{key:-1,value:-1},"禁用"))),"add"===g.operateType?r.a.createElement(k.a.Item,A({label:"赋予"},z),r.a.createElement("span",{style:{color:"green"}},"新增菜单后请前往角色管理将菜单授权给相关角色")):null)))}))}}]);