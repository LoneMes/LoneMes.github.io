(self.webpackChunkreact_luo=self.webpackChunkreact_luo||[]).push([[648],{8212:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(67294),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"},l=n(27029),o=function(e,t){return r.createElement(l.Z,Object.assign({},e,{ref:t,icon:a}))};o.displayName="EditOutlined";var i=r.forwardRef(o)},76570:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(67294),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},l=n(27029),o=function(e,t){return r.createElement(l.Z,Object.assign({},e,{ref:t,icon:a}))};o.displayName="SearchOutlined";var i=r.forwardRef(o)},96263:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return P}});var r=n(67294),a=n(37703),l=n(93002),o=n(73291),i=n(97538),u=(n(29809),n(65400)),s=(n(1025),n(51024)),c=(n(89858),n(2307)),d=(n(15144),n(11187)),f=(n(75314),n(35297)),p=(n(78994),n(56697)),m=(n(53294),n(94055)),w=(n(15086),n(74253)),h=(n(56120),n(64749)),v=(n(35797),n(8799)),y=(n(59567),n(95357)),g=n(9034),E=n(8212),b=n(73171),k=n(1977),C=n(76570),S=n(4599),Z=n(31059),x=(n(7940),n(89552)),T=(n(9405),function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var l=arguments[t],o=0,i=l.length;o<i;o++,a++)r[a]=l[o];return r});function I(e){var t=(0,r.useState)([]),n=t[0],a=t[1],l=(0,r.useState)([]),o=l[0],i=l[1];(0,r.useEffect)((function(){a(e.defaultChecked.menus||[]),i(e.defaultChecked.powers||[])}),[e.defaultChecked]);var u=(0,r.useCallback)((function(){e.onOk&&e.onOk({menus:n,powers:o})}),[e,o,n]),s=(0,r.useCallback)((function(){e.onClose()}),[e]),d=(0,r.useCallback)((function(e){return!!o.find((function(t){return t===e}))}),[o]),f=(0,r.useCallback)((function(e,t,r){var l=T(o),u=T(n);if(e.target.checked)l.push(t),u=Array.from(new Set(T([r.id],n)));else{l.splice(l.indexOf(t),1);var s=r.powers.map((function(e){return e.id}));o.some((function(e){return e!==t&&s.indexOf(e)>=0}))||u.splice(u.indexOf(r.id),1)}i(l),a(u)}),[o,n]),m=(0,r.useCallback)((function(e,t){var n;return(n=e?t.filter((function(t){return t.parent===e.id})):t.filter((function(e){return!e.parent}))).forEach((function(e){e.children=m(e,t),e.key=e.id})),n.length?n:null}),[]),w=(0,r.useMemo)((function(){var t=T(e.data);return t.sort((function(e,t){return e.sorts-t.sorts})),m(null,t)||[]}),[e.data,m]),h=(0,r.useMemo)((function(){return{onChange:function(e){a(e)},onSelect:function(t,n){var r=e.data.find((function(e){return e.id===t.id}));if(n){if(r&&Array.isArray(r.powers)){var a=Array.from(new Set(T(r.powers.map((function(e){return e.id})),o)));i(a)}}else if(r&&Array.isArray(r.powers)){var l=r.powers.map((function(e){return e.id}));a=o.filter((function(e){return l.indexOf(e)<0}));i(a)}},onSelectAll:function(t){i(t?e.data.reduce((function(e,t){return T(e,t.powers.map((function(e){return e.id})))}),[]):[])},selectedRowKeys:n}}),[e.data,n,o]),v=(0,r.useMemo)((function(){return[{title:"菜单",dataIndex:"title",key:"title",width:"30%"},{title:"权限",dataIndex:"powers",key:"powers",width:"70%",render:function(e,t){return e?e.map((function(e,n){return r.createElement(Z.default,{key:n,checked:d(e.id),onChange:function(n){return f(n,e.id,t)}},e.title)})):null}}]}),[d,f]);return r.createElement(p.Z,{className:"menu-tree-table",zIndex:1001,width:750,title:e.title||"请选择",visible:e.modalShow,onOk:u,onCancel:s,confirmLoading:e.loading},e.initloading?r.createElement("div",{style:{textAlign:"center"}},r.createElement(x.default,{tip:"加载中…"})):r.createElement(c.Z,{columns:v,rowSelection:h,dataSource:w,pagination:!1,defaultExpandAllRows:!0}))}var O=function(){return(O=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},A=function(e,t,n,r){return new(n||(n=Promise))((function(a,l){function o(e){try{u(r.next(e))}catch(e){l(e)}}function i(e){try{u(r.throw(e))}catch(e){l(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}u((r=r.apply(e,t||[])).next())}))},R=function(e,t){var n,r,a,l,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function i(l){return function(i){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,r=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){o.label=l[1];break}if(6===l[0]&&o.label<a[1]){o.label=a[1],a=l;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(l);break}a[2]&&o.ops.pop(),o.trys.pop();continue}l=t.call(e,o)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,i])}}},N=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var l=arguments[t],o=0,i=l.length;o<i;o++,a++)r[a]=l[o];return r},D=s.Z.TextArea,z=h.default.Option,L={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}};var P=(0,a.$j)((function(e){return{powersCode:e.app.powersCode,powerTreeData:e.sys.powerTreeData}}),(function(e){return{getAllMenusAndPowers:e.sys.getAllMenusAndPowers,getRoles:e.sys.getRoles,addRole:e.sys.addRole,upRole:e.sys.upRole,delRole:e.sys.delRole,setPowersByRoleId:e.sys.setPowersByRoleId,findAllPowerByRoleId:e.sys.findAllPowerByRoleId,updateUserInfo:e.app.updateUserInfo}}))((function(e){var t=this,n=e.powersCode,a=i.Z.useForm()[0],Z=(0,r.useState)([]),x=Z[0],T=Z[1],P=(0,r.useState)(!1),M=P[0],B=P[1],q=(0,l.Z)({pageNum:1,pageSize:10,total:0}),U=q[0],j=q[1],F=(0,l.Z)({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),V=F[0],_=F[1],G=(0,l.Z)({title:void 0,conditions:void 0}),H=G[0],J=G[1],K=(0,l.Z)({treeOnOkLoading:!1,powerTreeShow:!1,powerTreeDefault:{menus:[],powers:[]}}),Q=K[0],$=K[1];(0,o.Z)((function(){X(U),W()}));var W=function(){e.getAllMenusAndPowers()},X=function(n){return A(t,void 0,void 0,(function(){var t,r,a;return R(this,(function(l){switch(l.label){case 0:if(!e.powersCode.includes("role:query"))return[2];t={pageNum:n.pageNum,pageSize:n.pageSize,title:H.title,conditions:H.conditions},B(!0),l.label=1;case 1:return l.trys.push([1,,3,4]),[4,e.getRoles(S.Z.clearNull(t))];case 2:return(r=l.sent())&&200===r.status?(T(r.data.list),j({total:r.data.total,pageNum:n.pageNum,pageSize:n.pageSize})):d.default.error(null!==(a=null==r?void 0:r.message)&&void 0!==a?a:"获取失败"),[3,4];case 3:return B(!1),[7];case 4:return[2]}}))}))},Y=function(e,t){_({modalShow:!0,nowData:e,operateType:t}),setTimeout((function(){"add"===t?a.resetFields():a.setFieldsValue({formConditions:null==e?void 0:e.conditions,formDesc:null==e?void 0:e.desc,formSorts:null==e?void 0:e.sorts,formTitle:null==e?void 0:e.title})}))},ee=function(){_({modalShow:!1})},te=function(){$({powerTreeShow:!1})},ne=function(e,t){X({pageNum:e,pageSize:t||U.pageSize})},re=[{title:"序号",dataIndex:"serial",key:"serial"},{title:"角色名",dataIndex:"title",key:"title"},{title:"描述",dataIndex:"desc",key:"desc"},{title:"排序",dataIndex:"sorts",key:"sorts"},{title:"状态",dataIndex:"conditions",key:"conditions",render:function(e,t){return 1===e?r.createElement("span",{style:{color:"green"}},"启用"):r.createElement("span",{style:{color:"red"}},"禁用")}},{title:"操作",key:"control",width:200,render:function(a,l){var o=[];n.includes("role:query")&&o.push(r.createElement("span",{key:"0",className:"control-btn green",onClick:function(){return Y(l,"see")}},r.createElement(m.default,{placement:"top",title:"查看"},r.createElement(y.Z,null)))),n.includes("role:up")&&o.push(r.createElement("span",{key:"1",className:"control-btn blue",onClick:function(){return Y(l,"up")}},r.createElement(m.default,{placement:"top",title:"修改"},r.createElement(g.Z,null)))),n.includes("role:power")&&o.push(r.createElement("span",{key:"2",className:"control-btn blue",onClick:function(){return function(e){var t=e.menuAndPowers.map((function(e){return e.menuId})),n=e.menuAndPowers.reduce((function(e,t){return N(e,t.powers)}),[]);_({nowData:e}),$({powerTreeShow:!0,powerTreeDefault:{menus:t,powers:n}})}(l)}},r.createElement(m.default,{placement:"top",title:"分配权限"},r.createElement(E.Z,null)))),n.includes("role:del")&&o.push(r.createElement(f.Z,{key:"3",title:"确定删除吗?",onConfirm:function(){return n=l.id,A(t,void 0,void 0,(function(){var t,r;return R(this,(function(a){switch(a.label){case 0:B(!0),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,e.delRole({id:n})];case 2:return(t=a.sent())&&200===t.status?(d.default.success("删除成功"),X(U),e.updateUserInfo()):d.default.error(null!==(r=null==t?void 0:t.message)&&void 0!==r?r:"操作失败"),[3,4];case 3:return B(!1),[7];case 4:return[2]}}))}));var n},okText:"确定",cancelText:"取消"},r.createElement("span",{className:"control-btn red"},r.createElement(m.default,{placement:"top",title:"删除"},r.createElement(b.Z,null)))));var i=[];return o.forEach((function(e,t){t&&i.push(r.createElement(w.Z,{key:"line"+t,type:"vertical"})),i.push(e)})),i}}],ae=(0,r.useMemo)((function(){return x.map((function(e,t){return{key:t,id:e.id,serial:t+1+(U.pageNum-1)*U.pageSize,title:e.title,desc:e.desc,sorts:e.sorts,conditions:e.conditions,control:e.id,menuAndPowers:e.menuAndPowers}}))}),[U,x]);return r.createElement("div",null,r.createElement("div",{className:"g-search"},r.createElement("ul",{className:"search-func"},r.createElement("li",null,r.createElement(u.default,{type:"primary",icon:r.createElement(k.Z,null),disabled:!n.includes("role:add"),onClick:function(){return Y(null,"add")}},"添加角色"))),r.createElement(w.Z,{type:"vertical"}),n.includes("role:query")&&r.createElement("ul",{className:"search-ul"},r.createElement("li",null,r.createElement(s.Z,{placeholder:"请输入角色名",onChange:function(e){e.target.value.length<20&&J({title:e.target.value})},value:H.title})),r.createElement("li",null,r.createElement(h.default,{placeholder:"请选择状态",allowClear:!0,style:{width:"200px"},onChange:function(e){J({conditions:e})},value:H.conditions},r.createElement(z,{value:1},"启用"),r.createElement(z,{value:-1},"禁用"))),r.createElement("li",null,r.createElement(u.default,{type:"primary",icon:r.createElement(C.Z,null),onClick:function(){X(U)}},"搜索")))),r.createElement("div",{className:"diy-table"},r.createElement(c.Z,{columns:re,loading:M,dataSource:ae,pagination:{total:U.total,current:U.pageNum,pageSize:U.pageSize,showQuickJumper:!0,showTotal:function(e,t){return"共 "+e+" 条数据"},onChange:function(e,t){return ne(e,t)}}})),r.createElement(p.Z,{title:{add:"新增",up:"修改",see:"查看"}[V.operateType],visible:V.modalShow,onOk:function(){return A(t,void 0,void 0,(function(){var t,n,r,l;return R(this,(function(o){switch(o.label){case 0:if("see"===V.operateType)return ee(),[2];o.label=1;case 1:return o.trys.push([1,12,,13]),[4,a.validateFields()];case 2:if(t=o.sent(),_({modalLoading:!0}),n={title:t.formTitle,desc:t.formDesc,sorts:t.formSorts,conditions:t.formConditions},"add"!==V.operateType)return[3,7];o.label=3;case 3:return o.trys.push([3,,5,6]),[4,e.addRole(n)];case 4:return(r=o.sent())&&200===r.status&&(d.default.success("添加成功"),X(U),e.updateUserInfo(),ee()),[3,6];case 5:return _({modalLoading:!1}),[7];case 6:return[3,11];case 7:n.id=null===(l=null==V?void 0:V.nowData)||void 0===l?void 0:l.id,o.label=8;case 8:return o.trys.push([8,,10,11]),[4,e.upRole(n)];case 9:return(r=o.sent())&&200===r.status&&(d.default.success("修改成功"),X(U),e.updateUserInfo(),ee()),[3,11];case 10:return _({modalLoading:!1}),[7];case 11:return[3,13];case 12:return o.sent(),[3,13];case 13:return[2]}}))}))},onCancel:function(){return ee()},confirmLoading:V.modalLoading},r.createElement(i.Z,{form:a,initialValues:{formConditions:1}},r.createElement(i.Z.Item,O({label:"角色名",name:"formTitle"},L,{rules:[{required:!0,whitespace:!0,message:"必填"},{max:12,message:"最多输入12位字符"}]}),r.createElement(s.Z,{placeholder:"请输入角色名",disabled:"see"===V.operateType})),r.createElement(i.Z.Item,O({label:"描述",name:"formDesc"},L,{rules:[{max:100,message:"最多输入100个字符"}]}),r.createElement(D,{rows:4,disabled:"see"===V.operateType,autoSize:{minRows:2,maxRows:6}})),r.createElement(i.Z.Item,O({label:"排序",name:"formSorts"},L,{rules:[{required:!0,message:"请输入排序号"}]}),r.createElement(v.Z,{min:0,max:99999,style:{width:"100%"},disabled:"see"===V.operateType})),r.createElement(i.Z.Item,O({label:"状态",name:"formConditions"},L,{rules:[{required:!0,message:"请选择状态"}]}),r.createElement(h.default,{disabled:"see"===V.operateType},r.createElement(z,{key:1,value:1},"启用"),r.createElement(z,{key:-1,value:-1},"禁用"))))),r.createElement(I,{title:V.nowData?"分配权限："+V.nowData.title:"分配权限",data:e.powerTreeData,defaultChecked:Q.powerTreeDefault,loading:Q.treeOnOkLoading,modalShow:Q.powerTreeShow,onOk:function(n){return A(t,void 0,void 0,(function(){var t,r,a,l;return R(this,(function(o){switch(o.label){case 0:if(!(null===(a=null==V?void 0:V.nowData)||void 0===a?void 0:a.id))return d.default.error("该数据没有ID"),[2];t={id:V.nowData.id,menus:n.menus,powers:n.powers},$({treeOnOkLoading:!0}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,e.setPowersByRoleId(t)];case 2:return(r=o.sent())&&200===r.status?(X(U),e.updateUserInfo(),te()):d.default.error(null!==(l=null==r?void 0:r.message)&&void 0!==l?l:"权限分配失败"),[3,4];case 3:return $({treeOnOkLoading:!1}),[7];case 4:return[2]}}))}))},onClose:te}))}))}}]);