(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{1054:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return ce}));a(725);var n,r=a(727),o=a.n(r),i=(a(757),a(772)),s=a.n(i),c=(a(729),a(741)),l=a.n(c),u=a(224),d=a.n(u),m=(a(730),a(738)),p=a.n(m),f=(a(312),a(311)),h=a.n(f),y=a(2),k=a.n(y),E=a(12),v=a.n(E),b=(a(744),a(750)),g=a.n(b),S=(a(745),a(749)),w=a.n(S),D=(a(219),a(101)),x=a.n(D),T=(a(123),a(9)),C=a.n(T),I=a(20),N=a.n(I),M=a(19),U=a.n(M),q=a(21),J=a.n(q),L=a(22),O=a.n(L),B=a(42),P=a.n(B),R=a(23),F=a.n(R),j=a(30),A=a.n(j),K=(a(732),a(735)),V=a.n(K),z=(a(731),a(726)),Q=a.n(z),Y=(a(758),a(759)),G=a.n(Y),H=a(0),W=a.n(H),X=a(61),Z=(a(124),a(225)),$=a.n(Z),_=(a(827),a(1051)),ee=a(1050),te=a(1049),ae=a(1048),ne=["icon-Dollar","icon-compass","icon-EURO","icon-time-circle","icon-earth","icon-YUAN","icon-message","icon-dashboard","icon-piechart","icon-setting","icon-eye","icon-save","icon-appstore","icon-control","icon-detail","icon-project","icon-wallet","icon-user","icon-team","icon-areachart","icon-linechart","icon-barchart","icon-pointmap","icon-database","icon-reconciliation","icon-securityscan","icon-propertysafety","icon-safetycertificate","icon-alert","icon-bulb","icon-trophy","icon-USB","icon-home","icon-like","icon-unlock","icon-lock","icon-customerservice","icon-flag","icon-moneycollect","icon-medicinebox","icon-shop","icon-rocket","icon-shopping","icon-folder","icon-folder-open","icon-sliders","icon-cloud","icon-crown","icon-desktop","icon-gift"],re=a(210),oe=G.a.TreeNode,ie=Q.a.Option,se=V.a.TextArea,ce=Object(X.b)((function(e){return{roles:e.sys.roles,powersCode:e.app.powersCode}}),(function(e){return{addMenu:e.sys.addMenu,getMenus:e.sys.getMenus,upMenu:e.sys.upMenu,delMenu:e.sys.delMenu}}))(n=function(e){function t(e){var a;return N()(this,t),a=J()(this,O()(t).call(this,e)),A()(P()(a),"onTreeSelect",(function(e,t){var n={};t.selected&&(n={title:t.node.title,id:t.node.id}),a.setState({treeSelect:n,tableData:a.state.data.filter((function(e){return e.parent===(Number(n.id)||null)}))})})),A()(P()(a),"getNameByParentId",(function(e){var t=a.state.data.find((function(t){return t.id===e}));return t?t.title:void 0})),A()(P()(a),"onModalShow",(function(e,t){a.setState({modalShow:!0,nowData:e,operateType:t,formParent:"add"===t?{label:void 0,value:void 0}:{label:a.getNameByParentId(e.parent),value:e.parent}}),setTimeout((function(){"add"===t?a.form.current.resetFields():a.form.current.setFieldsValue({formConditions:e.conditions,formDesc:e.desc,formIcon:e.icon,formSorts:e.sorts,formTitle:e.title,formUrl:e.url})}))})),A()(P()(a),"onClose",(function(){a.setState({modalShow:!1})})),A()(P()(a),"onDel",(function(e){var t={id:e.id};a.props.delMenu(t).then((function(e){200===e.status?(a.getData(),a.props.updateUserInfo(),C.a.success("删除成功")):C.a.error(e.message)}))})),A()(P()(a),"makeColumns",(function(){return[{title:"序号",dataIndex:"serial",key:"serial"},{title:"图标",dataIndex:"icon",key:"icon",render:function(e){return e?W.a.createElement(re.a,{type:e}):""}},{title:"菜单名称",dataIndex:"title",key:"title"},{title:"路径",dataIndex:"url",key:"url",render:function(e,t){return e?"/".concat(e.replace(/^\//,"")):""}},{title:"描述",dataIndex:"desc",key:"desc"},{title:"父级",dataIndex:"parent",key:"parent",render:function(e){return a.getNameByParentId(e)}},{title:"状态",dataIndex:"conditions",key:"conditions",render:function(e,t){return 1===e?W.a.createElement("span",{style:{color:"green"}},"启用"):W.a.createElement("span",{style:{color:"red"}},"禁用")}},{title:"操作",key:"control",width:120,render:function(e,t){var n=a.props.powersCode,r=[];n.includes("menu:query")&&r.push(W.a.createElement("span",{key:"0",className:"control-btn green",onClick:function(){return a.onModalShow(t,"see")}},W.a.createElement(x.a,{placement:"top",title:"查看"},W.a.createElement(_.a,null)))),n.includes("menu:up")&&r.push(W.a.createElement("span",{key:"1",className:"control-btn blue",onClick:function(){return a.onModalShow(t,"up")}},W.a.createElement(x.a,{placement:"top",title:"修改"},W.a.createElement(ee.a,null)))),n.includes("menu:del")&&r.push(W.a.createElement(w.a,{key:"2",title:"确定删除吗?",okText:"确定",cancelText:"取消",onConfirm:function(){return a.onDel(t)}},W.a.createElement("span",{className:"control-btn red"},W.a.createElement(x.a,{placement:"top",title:"删除"},W.a.createElement(te.a,null)))));var o=[];return r.forEach((function(e,t){t&&o.push(W.a.createElement(g.a,{key:"line".concat(t),type:"vertical"})),o.push(e)})),o}}]})),a.form=W.a.createRef(),a.state={data:[],sourceData:[],loading:!1,tableData:[],treeSelect:{},nowData:null,operateType:"add",modalShow:!1,modalLoading:!1,rolesCheckboxChose:[]},a}var a;return F()(t,e),U()(t,[{key:"componentDidMount",value:function(){this.getData()}},{key:"getData",value:function(){var e=this;this.props.powersCode.includes("menu:query")&&(this.setState({loading:!0}),this.props.getMenus().then((function(t){200===t.status&&(e.setState({data:t.data,tableData:t.data.filter((function(t){return t.parent===(Number(e.state.treeSelect.id)||null)}))}),e.makeSourceData(t.data)),e.setState({loading:!1})})).catch((function(){e.setState({loading:!1})})))}},{key:"makeSourceData",value:function(e){var t=$.a.cloneDeep(e);t.forEach((function(e){e.key=String(e.id)})),t.sort((function(e,t){return e.sorts-t.sorts}));var a=this.dataToJson(null,t)||[];this.setState({sourceData:a})}},{key:"dataToJson",value:function(e,t){var a,n=this;return(a=e?t.filter((function(t){return t.parent===e.id})):t.filter((function(e){return!e.parent}))).forEach((function(e){return e.children=n.dataToJson(e,t)})),a.length?a:null}},{key:"makeTreeDom",value:function(e){var t=this;return e.map((function(e){return e.children?W.a.createElement(oe,{title:e.title,key:"".concat(e.id)},t.makeTreeDom(e.children)):W.a.createElement(oe,{title:e.title,key:"".concat(e.id)})}))}},{key:"onOk",value:(a=v()(k.a.mark((function e(){var t,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("see"!==this.state.operateType){e.next=3;break}return this.onClose(),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.form.current.validateFields();case 6:if(t=e.sent,a={title:t.formTitle,url:t.formUrl,icon:t.formIcon,parent:Number(this.state.treeSelect.id)||null,sorts:t.formSorts,desc:t.formDesc,conditions:t.formConditions},this.setState({modalLoading:!0}),"add"!==this.state.operateType){e.next=20;break}return e.prev=10,e.next=13,this.props.addMenu(a);case 13:200===e.sent.status?(C.a.success("添加成功"),this.getData(),this.onClose(),this.props.updateUserInfo()):C.a.error("添加失败");case 15:return e.prev=15,this.setState({modalLoading:!1}),e.finish(15);case 18:e.next=29;break;case 20:return e.prev=20,a.id=this.state.nowData.id,e.next=24,this.props.upMenu(a);case 24:200===e.sent.status?(C.a.success("修改成功"),this.getData(),this.onClose(),this.props.updateUserInfo()):C.a.error("修改失败");case 26:return e.prev=26,this.setState({modalLoading:!1}),e.finish(26);case 29:e.next=33;break;case 31:e.prev=31,e.t0=e.catch(3);case 33:case"end":return e.stop()}}),e,this,[[3,31],[10,,15,18],[20,,26,29]])}))),function(){return a.apply(this,arguments)})},{key:"makeData",value:function(e){return e?e.map((function(e,t){return{key:t,id:e.id,icon:e.icon,parent:e.parent,title:e.title,url:e.url,desc:e.desc,sorts:e.sorts,conditions:e.conditions,serial:t+1}})):[]}},{key:"render",value:function(){var e=this,t=this.props.powersCode,a={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}};return W.a.createElement("div",{className:"page-menu-admin"},W.a.createElement("div",{className:"l"},W.a.createElement("div",{className:"title"},"目录结构"),W.a.createElement("div",null,W.a.createElement(G.a,{defaultExpandedKeys:["0"],onSelect:this.onTreeSelect,selectedKeys:[String(this.state.treeSelect.id)],treeData:this.state.sourceData}))),W.a.createElement("div",{className:"r"},W.a.createElement("div",{className:"searchBox"},W.a.createElement("ul",null,W.a.createElement("li",null,W.a.createElement(h.a,{type:"primary",icon:W.a.createElement(ae.a,null),onClick:function(){return e.onModalShow(null,"add")},disabled:!t.includes("menu:add")},"添加".concat(this.state.treeSelect.title||"根级","子菜单"))))),W.a.createElement(p.a,{className:"diy-table",columns:this.makeColumns(),loading:this.state.loading,dataSource:this.makeData(this.state.tableData),pagination:{showQuickJumper:!0,showTotal:function(e,t){return"共 ".concat(e," 条数据")}}})),W.a.createElement(o.a,{title:"".concat({add:"新增",up:"修改",see:"查看"}[this.state.operateType]),visible:this.state.modalShow,onOk:function(){return e.onOk()},onCancel:this.onClose,confirmLoading:this.state.modalLoading},W.a.createElement(l.a,{ref:this.form,initialValues:{formConditions:1}},W.a.createElement(l.a.Item,d()({label:"菜单名",name:"formTitle"},a,{rules:[{required:!0,whitespace:!0,message:"必填"},{max:12,message:"最多输入12位字符"}]}),W.a.createElement(V.a,{placeholder:"请输入菜单名",disabled:"see"===this.state.operateType})),W.a.createElement(l.a.Item,d()({label:"菜单链接",name:"formUrl"},a,{rules:[{required:!0,whitespace:!0,message:"必填"}]}),W.a.createElement(V.a,{placeholder:"请输入菜单链接",disabled:"see"===this.state.operateType})),W.a.createElement(l.a.Item,d()({label:"图标",name:"formIcon"},a),W.a.createElement(Q.a,{dropdownClassName:"iconSelect",disabled:"see"===this.state.operateType},ne.map((function(e,t){return W.a.createElement(ie,{key:t,value:e},W.a.createElement(re.a,{type:e}))})))),W.a.createElement(l.a.Item,d()({label:"描述",name:"formDesc"},a,{rules:[{max:100,message:"最多输入100位字符"}]}),W.a.createElement(se,{rows:4,disabled:"see"===this.state.operateType,placeholoder:"请输入描述",autosize:{minRows:2,maxRows:6}})),W.a.createElement(l.a.Item,d()({label:"排序",name:"formSorts"},a,{rules:[{required:!0,message:"请输入排序号"}]}),W.a.createElement(s.a,{min:0,max:99999,style:{width:"100%"},disabled:"see"===this.state.operateType})),W.a.createElement(l.a.Item,d()({label:"状态",name:"formConditions"},a,{rules:[{required:!0,message:"请选择状态"}]}),W.a.createElement(Q.a,{disabled:"see"===this.state.operateType},W.a.createElement(ie,{key:1,value:1},"启用"),W.a.createElement(ie,{key:-1,value:-1},"禁用"))),"add"===this.state.operateType?W.a.createElement(l.a.Item,d()({label:"赋予"},a),W.a.createElement("span",{style:{color:"green"}},"新增菜单后请前往角色管理将菜单授权给相关角色")):null)))}}]),t}(W.a.Component))||n},827:function(e,t,a){}}]);